#include <iostream>
#include <Windows.h>
#include <string>
#include <thread>
#include <vector>
#include <mutex>

#include "Execution.hpp"
#include "Bypass.hpp"


void launch()
{
	std::thread(Bypass::bypass_thread).detach(); // find the correct roblox process

	roblox_state = Addresses::r_lua_newthread(LuaState::get_robloxstate()); // grab the roblox lua state we created
	Lua::r_securitylevel(roblox_state, 8); // increase the level of our new state
	Lua::r_sandboxthread(roblox_state); // sandboxthread
	
	MAP_INT3();
	AddVectoredExceptionHandler(1, VEH); // Veh bypass
	
	Api::registration(roblox_state); // register custom functions

	Execution::execute(roblox_state, "warn('nezy exploit loaded!')");

	std::thread(Execution::pipe).detach();
}


int __stdcall DllMain(void*, int reason, void*)
{
	if (reason == 1)
	{
		std::thread(launch).detach();
	}
	return 1;
}
